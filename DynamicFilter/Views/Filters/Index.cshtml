@model IEnumerable<DynamicFilter.Models.Filter>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Tickets</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>


<div>
    <table id="example" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Ticket</th>
                <th>Application</th>
                <th>Function</th>
                <th>State</th>
                <th>Title</th>
                <th>Description</th>
                <th>Description2</th>
                <th>Solution</th>
                <th>Detail2</th>
                <th>CreatedBy</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
    </table>
</div>


@section scripts {
    <script type="text/javascript">
        $(document).ready(function () {

            //var table = $('#example').DataTable();
            //table.destroy();

            $('#example').DataTable({
                "processing": true,
                "serverSide": false,
                "ajax": {
                    "url": "@Url.Action("Get","Filters")",
                    "type": "POST"
                },
                "order": [[3, "desc"]],
                "columns": [
                    { "data": "FilterID"},
                    { "data": "Category.Name" },
                    { "data": "Type.Name" },
                    { "data": "State.Name" },
                    { "data": "Place" },
                    { "data": "Description" },
                    { "data": "Description" },
                    { "data": "Detail" },
                    { "data": "Detail" },
                    { "data": "User.UserName" },
                    { "data": "FilterID" ,
                        "render": function (data, type, row) {
                            var estado = row.State.Name;
                            var url;
                            if (estado != "Cerrado") {
                                url = '@Html.ActionLink("Edit", "Edit", new { id= 1})';
                            }
                            else {
                              url = '@Html.ActionLink(" ", "", new { id= 1})';
                            }
                            return url.replace('1',data);
                        }},
                    { "data": "FilterID"},
                ],
                columnDefs: [
                    {
                    targets: 11,
                        render: function (data, type, row) {
                        var url = '@Html.ActionLink("Delete", "Delete", new { id=1 })';
                        return url.replace('1',data);
                        }
                    },
                    @*{
                    targets: 10,
                        render: function (data, type, row) {
                            var url;
                                url = '@Html.ActionLink("Edit", "Edit", new { id=1 })';
                            return url.replace('1',data);
                        }
                    },*@
                    {
                        targets: 8,
                        visible:false
                    },
                    {
                    targets: 7,
                        render: function (data, type, row) {

                        if (data!=null) {
                            if (data.length > 21) {
                                data=data.substr(0, 21) + '…';
                            }
                        }
                            return data;
                        }

                    },
                    {
                    targets: 4,
                        render: function (data, type, row) {

                            if (data!=null) {
                                if (data.length > 21) {
                                data=data.substr(0, 21) + '…';
                            }
                            }

                            return data;
                        }
                    },
                    {
                        targets: 6,
                        visible: false
                    },
                 ]
            });
            });
    </script>
}